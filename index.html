<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A4 Full Width Invoice - Patel Diagnostic Udaipur</title>
    <style>
        /* Classic Professional Typography */
        body { 
            font-family: "Times New Roman", Times, serif; 
            color: #000; 
            margin: 0; 
            padding: 0; 
            background: #f4f4f4; 
        }
        
        /* A4 Full Width Container */
        .invoice-container { 
            width: 210mm; /* Full A4 Width */
            min-height: 148mm; /* A5 Height for a landscape-style or half-page feel */
            padding: 15mm;
            margin: 20px auto;
            background: #fff;
            box-sizing: border-box;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        /* Lab Header - No Logo as per request */
        .lab-heading { text-align: center; margin-bottom: 25px; }
        .lab-heading h1 { margin: 0; font-size: 26px; letter-spacing: 1.5px; text-transform: uppercase; }
        .lab-heading p { margin: 5px 0; font-size: 14px; }

        /* Patient Info - Exact 3 Line Structure */
        .info-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            border-bottom: 0.5px solid #ddd;
            padding-bottom: 5px;
        }
        .info-item { display: flex; align-items: center; }
        .info-item span { font-weight: bold; margin-right: 8px; }
        .info-item input { 
            border: none; 
            font-family: "Times New Roman", serif; 
            font-size: 16px; 
            outline: none;
            background: transparent;
            width: 250px;
        }

        /* Table Design - Simple Lines */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { 
            text-align: left; 
            border-bottom: 1.5px solid #000; 
            padding: 10px 5px; 
            font-size: 15px; 
        }
        td { padding: 12px 5px; border-bottom: 0.5px solid #eee; font-size: 15px; }

        /* Totals Area */
        .totals { float: right; width: 250px; text-align: right; margin-top: 30px; }
        .discount-row { font-size: 14px; color: #555; margin-bottom: 5px; }
        .total-line { 
            border-top: 1.5px solid #000; 
            margin-top: 8px; 
            padding-top: 8px; 
            font-weight: bold; 
            font-size: 18px; 
        }

        .hide-discount { display: none !important; }

        /* UI Controls - Hidden during Print */
        .no-print { 
            max-width: 210mm; 
            margin: 10px auto; 
            padding: 20px; 
            background: #fff; 
            border: 1px solid #ccc; 
            font-family: Arial, sans-serif;
        }
        .btn { 
            padding: 10px 20px; 
            cursor: pointer; 
            border: 1px solid #000; 
            background: #fff; 
            font-weight: bold;
            margin-right: 10px;
        }
        .btn-save { background: #e67e22; color: #fff; border: none; }

        /* Print Logic */
        @media print {
            body { background: #fff; }
            .no-print { display: none !important; }
            .invoice-container { margin: 0; border: none; width: 210mm; padding: 15mm; box-shadow: none; }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <div style="margin-bottom: 15px;">
        üîç History: <input type="text" id="histSearch" onkeyup="searchHistory()" placeholder="Search Name/Mobile..." style="width: 300px; padding: 8px;">
        üî¨ Test: <input type="text" id="search" onkeyup="searchSheet()" placeholder="Search Test List..." style="width: 300px; padding: 8px;">
        <button class="btn" onclick="addManualRow()">+ Add Manual Test</button>
    </div>
    <button class="btn" onclick="generateNewInvoice()">üÜï New Bill</button>
    <button class="btn btn-save" onclick="saveToSheet()">üíæ Save to Sheet</button>
    <button class="btn" onclick="window.print()">üñ®Ô∏è Print Full Width A4</button>
</div>

<div class="invoice-container">
    <div class="lab-heading">
        <h1>PATEL DIAGNOSTIC UDAIPUR</h1>
        <p>Titaradi, Udaipur | Contact: 8209746239</p>
    </div>

    <div class="info-section">
        <div class="info-row">
            <div class="info-item"><span>Invoice No:</span> <span id="invNo">20260001</span></div>
            <div class="info-item"><span>Date & Time:</span> <span id="liveDateTime"></span></div>
        </div>
        <div class="info-row">
            <div class="info-item"><span>Name:</span><input type="text" id="pName" placeholder=".............................."></div>
            <div class="info-item"><span>Age:</span><input type="text" id="pAge" placeholder="...." style="width: 50px;"></div>
            <div class="info-item"><span>Sex:</span><input type="text" id="pSex" placeholder="M/F" style="width: 80px;"></div>
        </div>
        <div class="info-row">
            <div class="info-item"><span>Contact:</span><input type="text" id="pContact" placeholder=".............................."></div>
            <div class="info-item"><span>Ref. By:</span><input type="text" id="pRef" placeholder=".............................."></div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Test Description</th>
                <th style="width: 120px; text-align: right;">Amount (‚Çπ)</th>
            </tr>
        </thead>
        <tbody id="billingBody"></tbody>
    </table>

    <div class="totals">
        <div style="font-size: 14px;">Subtotal: ‚Çπ<span id="subtotal">0.00</span></div>
        <div id="discountWrapper" class="discount-row hide-discount">
            Discount: -‚Çπ<span id="discountVal">0.00</span>
        </div>
        <div class="total-line">
            Total Payable: ‚Çπ<span id="grandTotal">0.00</span>
        </div>
        <button class="no-print" onclick="applyDiscount()" style="font-size: 11px; margin-top: 10px; cursor: pointer;">Edit Discount</button>
    </div>

    <div style="clear: both; margin-top: 100px; text-align: center; font-size: 12px; font-style: italic; border-top: 0.5px solid #eee; padding-top: 10px;">
        Computer Generated Invoice - Patel Diagnostic Udaipur
    </div>
</div>

<script>
    const GOOGLE_SCRIPT_URL = "YOUR_GOOGLE_SCRIPT_WEB_APP_URL";

    // Live Clock
    function updateDateTime() {
        const now = new Date();
        document.getElementById('liveDateTime').innerText = now.toLocaleString('en-IN');
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Invoice Serial
    function loadInvoiceNumber() {
        let lastInv = localStorage.getItem('lastInvoiceNo') || 20260001;
        document.getElementById('invNo').innerText = lastInv;
    }

    function generateNewInvoice() {
        if(confirm("Confirm: Move to next invoice number?")) {
            let nextInv = parseInt(document.getElementById('invNo').innerText) + 1;
            localStorage.setItem('lastInvoiceNo', nextInv);
            location.reload(); 
        }
    }
    loadInvoiceNumber();

    // Billing Calculation
    let subtotal = 0;
    let discount = 0;

    function addManualRow() {
        const tbody = document.getElementById('billingBody');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="text" placeholder="Enter Test Name" style="width:100%; border:none; outline:none; font-family:'Times New Roman'; font-size:15px;"></td>
            <td style="text-align: right;"><input type="number" class="price-input" value="0" onchange="updateTotal()" style="width:100px; text-align:right; border:none; outline:none; font-family:'Times New Roman'; font-size:15px;"></td>
            <td class="no-print" style="width:30px; text-align:right;"><button onclick="this.parentElement.parentElement.remove(); updateTotal();" style="border:none; color:#ccc; cursor:pointer; background:none;">x</button></td>
        `;
        tbody.appendChild(row);
    }

    function updateTotal() {
        let total = 0;
        document.querySelectorAll('.price-input').forEach(input => {
            total += parseFloat(input.value) || 0;
        });
        subtotal = total;
        
        const discRow = document.getElementById('discountWrapper');
        if (discount > 0) discRow.classList.remove('hide-discount');
        else discRow.classList.add('hide-discount');

        document.getElementById('subtotal').innerText = subtotal.toFixed(2);
        document.getElementById('discountVal').innerText = discount.toFixed(2);
        document.getElementById('grandTotal').innerText = (subtotal - discount).toFixed(2);
    }

    function applyDiscount() {
        let val = prompt("Enter Discount Amount (‚Çπ):", discount);
        if (val !== null) {
            discount = parseFloat(val) || 0;
            updateTotal();
        }
    }

    // Google Sheets Save
    async function saveToSheet() {
        const data = {
            invoiceNo: document.getElementById('invNo').innerText,
            dateTime: document.getElementById('liveDateTime').innerText,
            name: document.getElementById('pName').value,
            age: document.getElementById('pAge').value,
            sex: document.getElementById('pSex').value,
            contact: document.getElementById('pContact').value,
            refBy: document.getElementById('pRef').value,
            total: document.getElementById('grandTotal').innerText
        };
        if(!data.name) return alert("Please enter patient name.");
        try {
            await fetch(GOOGLE_SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) });
            alert("Record Saved to Sheet!");
        } catch (e) { alert("Error saving to sheet."); }
    }

    function searchSheet() {}
    function searchHistory() {}
</script>

</body>
</html>
